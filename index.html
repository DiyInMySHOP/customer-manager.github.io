<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏á‡∏≤‡∏ô‡∏õ‡∏±‡∏Å‡∏ú‡πâ‡∏≤</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body class="bg-gradient-to-br from-pink-50 to-purple-50 min-h-screen">
    <div id="app" class="p-4 max-w-7xl mx-auto"></div>

    <script>
        let customers = [];
        let searchTerm = '';
        let showForm = false;
        let editingId = null;
        let formData = {
            name: '',
            phone: '',
            address: '',
            workDetails: '',
            startDate: '',
            dueDate: '',
            totalPrice: '',
            deposit: '',
            paid: '',
            status: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥',
            workImages: [],
            chatImages: []
        };

        function calculateRemaining(total, paid) {
            return (parseFloat(total) || 0) - (parseFloat(paid) || 0);
        }

        function resetForm() {
            formData = {
                name: '',
                phone: '',
                address: '',
                workDetails: '',
                startDate: '',
                dueDate: '',
                totalPrice: '',
                deposit: '',
                paid: '',
                status: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥',
                workImages: [],
                chatImages: []
            };
            editingId = null;
            showForm = false;
            render();
        }

        function handleSubmit(e) {
            e.preventDefault();
            
            if (editingId !== null) {
                customers = customers.map(c => 
                    c.id === editingId ? { ...formData, id: editingId } : c
                );
            } else {
                customers.push({ ...formData, id: Date.now() });
            }
            
            resetForm();
        }

        function handleEdit(customer) {
            formData = { ...customer };
            editingId = customer.id;
            showForm = true;
            render();
        }

        function handleDelete(id) {
            if (confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                customers = customers.filter(c => c.id !== id);
                render();
            }
        }

        function handleImageUpload(e, type) {
            const files = Array.from(e.target.files);
            files.forEach(file => {
                const reader = new FileReader();
                reader.onloadend = () => {
                    formData[type].push(reader.result);
                    render();
                };
                reader.readAsDataURL(file);
            });
        }

        function removeImage(type, index) {
            formData[type] = formData[type].filter((_, i) => i !== index);
            render();
        }

        function handleImportExcel(e) {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (evt) => {
                try {
                    const data = evt.target.result;
                    const workbook = XLSX.read(data, { type: 'binary' });
                    const sheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[sheetName];
                    const jsonData = XLSX.utils.sheet_to_json(worksheet);

                    customers = jsonData.map((row, index) => ({
                        id: Date.now() + index,
                        name: row['‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤'] || '',
                        phone: row['‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£'] || '',
                        address: row['‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà'] || '',
                        workDetails: row['‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏á‡∏≤‡∏ô'] || '',
                        startDate: row['‡∏ß‡∏±‡∏ô‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô'] || '',
                        dueDate: row['‡∏ß‡∏±‡∏ô‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô'] || '',
                        totalPrice: row['‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ß‡∏°'] || '',
                        deposit: row['‡∏°‡∏±‡∏î‡∏à‡∏≥'] || '',
                        paid: row['‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß'] || '',
                        status: row['‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞'] || '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥',
                        workImages: [],
                        chatImages: []
                    }));

                    alert(`‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ${customers.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`);
                    render();
                } catch (error) {
                    alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏ü‡∏•‡πå Excel');
                    console.error(error);
                }
            };
            reader.readAsBinaryString(file);
            e.target.value = '';
        }

        function handleExportExcel() {
            if (customers.length === 0) {
                alert('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å');
                return;
            }

            const exportData = customers.map(c => ({
                '‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤': c.name,
                '‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£': c.phone,
                '‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà': c.address,
                '‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏á‡∏≤‡∏ô': c.workDetails,
                '‡∏ß‡∏±‡∏ô‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô': c.startDate,
                '‡∏ß‡∏±‡∏ô‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô': c.dueDate,
                '‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ß‡∏°': c.totalPrice,
                '‡∏°‡∏±‡∏î‡∏à‡∏≥': c.deposit,
                '‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß': c.paid,
                '‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠': calculateRemaining(c.totalPrice, c.paid),
                '‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞': c.status,
                '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏π‡∏õ‡∏á‡∏≤‡∏ô': c.workImages.length,
                '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ä‡∏ó': c.chatImages.length
            }));

            const ws = XLSX.utils.json_to_sheet(exportData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, '‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤');
            
            const date = new Date().toLocaleDateString('th-TH');
            XLSX.writeFile(wb, `‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏á‡∏≤‡∏ô‡∏õ‡∏±‡∏Å_${date}.xlsx`);
        }

        function render() {
            const filteredCustomers = customers.filter(c =>
                c.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                c.phone.includes(searchTerm) ||
                c.workDetails.toLowerCase().includes(searchTerm.toLowerCase())
            );

            const app = document.getElementById('app');
            app.innerHTML = `
                <!-- Header -->
                <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                    <h1 class="text-3xl font-bold text-purple-800 mb-4">üìå ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏á‡∏≤‡∏ô‡∏õ‡∏±‡∏Å‡∏ú‡πâ‡∏≤</h1>
                    
                    <div class="flex flex-wrap gap-3">
                        <label class="flex items-center gap-2 px-4 py-2 bg-blue-500 text-white rounded-lg cursor-pointer hover:bg-blue-600 transition">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"/>
                            </svg>
                            <span>‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤ Excel</span>
                            <input type="file" accept=".xlsx,.xls" onchange="handleImportExcel(event)" class="hidden" />
                        </label>
                        
                        <button onclick="handleExportExcel()" class="flex items-center gap-2 px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
                            </svg>
                            <span>‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å Excel</span>
                        </button>
                        
                        <button onclick="showForm = true; render();" class="flex items-center gap-2 px-4 py-2 bg-purple-500 text-white rounded-lg hover:bg-purple-600 transition">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                            </svg>
                            <span>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà</span>
                        </button>
                    </div>

                    <div class="mt-4 relative">
                        <svg class="absolute left-3 top-3 w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                        </svg>
                        <input
                            type="text"
                            placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠, ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£, ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏á‡∏≤‡∏ô..."
                            value="${searchTerm}"
                            oninput="searchTerm = this.value; render();"
                            class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                        />
                    </div>
                </div>

                ${showForm ? renderForm() : ''}

                <!-- Customer List -->
                <div class="space-y-4">
                    ${filteredCustomers.length === 0 ? `
                        <div class="bg-white rounded-lg shadow p-8 text-center text-gray-500">
                            ${customers.length === 0 ? `
                                <p class="text-lg mb-2">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</p>
                                <p class="text-sm">‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤ Excel" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤ ‡∏´‡∏£‡∏∑‡∏≠ "‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</p>
                            ` : '<p>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</p>'}
                        </div>
                    ` : filteredCustomers.map(c => renderCustomerCard(c)).join('')}
                </div>

                ${customers.length > 0 ? renderSummary() : ''}
            `;
        }

        function renderForm() {
            return `
                <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 overflow-y-auto">
                    <div class="bg-white rounded-lg shadow-xl w-full max-w-3xl my-8">
                        <div class="p-6">
                            <div class="flex justify-between items-center mb-4">
                                <h2 class="text-2xl font-bold text-purple-800">
                                    ${editingId ? '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤' : '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà'}
                                </h2>
                                <button onclick="resetForm()" class="text-gray-500 hover:text-gray-700">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                                    </svg>
                                </button>
                            </div>

                            <div class="space-y-4">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ *</label>
                                        <input type="text" value="${formData.name}" oninput="formData.name = this.value" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500" />
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</label>
                                        <input type="tel" value="${formData.phone}" oninput="formData.phone = this.value" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500" />
                                    </div>
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà</label>
                                    <textarea rows="2" oninput="formData.address = this.value" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">${formData.address}</textarea>
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏á‡∏≤‡∏ô</label>
                                    <textarea rows="3" oninput="formData.workDetails = this.value" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">${formData.workDetails}</textarea>
                                </div>

                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">‡∏ß‡∏±‡∏ô‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô</label>
                                        <input type="date" value="${formData.startDate}" oninput="formData.startDate = this.value" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500" />
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">‡∏ß‡∏±‡∏ô‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô</label>
                                        <input type="date" value="${formData.dueDate}" oninput="formData.dueDate = this.value" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500" />
                                    </div>
                                </div>

                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ß‡∏° (‡∏ö‡∏≤‡∏ó)</label>
                                        <input type="number" value="${formData.totalPrice}" oninput="formData.totalPrice = this.value; render();" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500" />
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">‡∏°‡∏±‡∏î‡∏à‡∏≥ (‡∏ö‡∏≤‡∏ó)</label>
                                        <input type="number" value="${formData.deposit}" oninput="formData.deposit = this.value" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500" />
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß (‡∏ö‡∏≤‡∏ó)</label>
                                        <input type="number" value="${formData.paid}" oninput="formData.paid = this.value; render();" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500" />
                                    </div>
                                </div>

                                ${formData.totalPrice ? `
                                    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-3">
                                        <p class="text-sm font-medium text-yellow-800">
                                            üí∞ ‡∏¢‡∏≠‡∏î‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠: ${calculateRemaining(formData.totalPrice, formData.paid).toLocaleString()} ‡∏ö‡∏≤‡∏ó
                                        </p>
                                    </div>
                                ` : ''}

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏á‡∏≤‡∏ô</label>
                                    <select onchange="formData.status = this.value" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                                        <option value="‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥" ${formData.status === '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥' ? 'selected' : ''}>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥</option>
                                        <option value="‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß" ${formData.status === '‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß' ? 'selected' : ''}>‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß</option>
                                        <option value="‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß" ${formData.status === '‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß' ? 'selected' : ''}>‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß</option>
                                    </select>
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏π‡∏õ‡∏á‡∏≤‡∏ô‡∏õ‡∏±‡∏Å</label>
                                    <label class="flex items-center justify-center gap-2 px-4 py-3 bg-purple-50 border-2 border-dashed border-purple-300 rounded-lg cursor-pointer hover:bg-purple-100 transition">
                                        <svg class="w-5 h-5 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                                        </svg>
                                        <span class="text-purple-600">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏π‡∏õ‡∏á‡∏≤‡∏ô</span>
                                        <input type="file" accept="image/*" multiple onchange="handleImageUpload(event, 'workImages')" class="hidden" />
                                    </label>
                                    ${formData.workImages.length > 0 ? `
                                        <div class="mt-2 grid grid-cols-4 gap-2">
                                            ${formData.workImages.map((img, idx) => `
                                                <div class="relative group">
                                                    <img src="${img}" alt="‡∏á‡∏≤‡∏ô‡∏õ‡∏±‡∏Å" class="w-full h-20 object-cover rounded" />
                                                    <button type="button" onclick="removeImage('workImages', ${idx})" class="absolute top-1 right-1 bg-red-500 text-white rounded-full p-1 opacity-0 group-hover:opacity-100 transition">
                                                        <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                                                        </svg>
                                                    </button>
                                                </div>
                                            `).join('')}
                                        </div>
                                    ` : ''}
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∏‡∏¢‡∏á‡∏≤‡∏ô</label>
                                    <label class="flex items-center justify-center gap-2 px-4 py-3 bg-blue-50 border-2 border-dashed border-blue-300 rounded-lg cursor-pointer hover:bg-blue-100 transition">
                                        <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                                        </svg>
                                        <span class="text-blue-600">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏π‡∏õ‡πÅ‡∏ä‡∏ó</span>
                                        <input type="file" accept="image/*" multiple onchange="handleImageUpload(event, 'chatImages')" class="hidden" />
                                    </label>
                                    ${formData.chatImages.length > 0 ? `
                                        <div class="mt-2 grid grid-cols-4 gap-2">
                                            ${formData.chatImages.map((img, idx) => `
                                                <div class="relative group">
                                                    <img src="${img}" alt="‡πÅ‡∏ä‡∏ó" class="w-full h-20 object-cover rounded" />
                                                    <button type="button" onclick="removeImage('chatImages', ${idx})" class="absolute top-1 right-1 bg-red-500 text-white rounded-full p-1 opacity-0 group-hover:opacity-100 transition">
                                                        <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                                                        </svg>
                                                    </button>
                                                </div>
                                            `).join('')}
                                        </div>
                                    ` : ''}
                                </div>

                                <div class="flex gap-3 pt-4">
                                    <button onclick="handleSubmit(event)" class="flex-1 bg-purple-500 text-white py-2 rounded-lg hover:bg-purple-600 transition font-medium">
                                        ${editingId ? '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç' : '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤'}
                                    </button>
                                    <button onclick="resetForm()" class="px-6 bg-gray-300 text-gray-700 py-2 rounded-lg hover:bg-gray-400 transition font-medium">
                                        ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderCustomerCard(customer) {
            const statusColor = customer.status === '‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß' ? 'bg-green-100 text-green-800' :
                               customer.status === '‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß' ? 'bg-blue-100 text-blue-800' :
                               'bg-yellow-100 text-yellow-800';

            return `
                <div class="bg-white rounded-lg shadow-lg p-6 hover:shadow-xl transition">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h3 class="text-xl font-bold text-purple-800">${customer.name}</h3>
                            <p class="text-gray-600">${customer.phone}</p>
                        </div>
                        <div class="flex gap-2">
                            <span class="px-3 py-1 rounded-full text-sm font-medium ${statusColor}">${customer.status}</span>
                            <button onclick='handleEdit(${JSON.stringify(customer).replace(/'/g, "\\'")}); event.stopPropagation();' class="p-2 text-blue-600 hover:bg-blue-50 rounded transition">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                                </svg>
                            </button>
                            <button onclick="handleDelete(${customer.id})" class="p-2 text-red-600 hover:bg-red-50 rounded transition">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                                </svg>
                            </button>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <p class="text-sm text-gray-600">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà</p>
                            <p class="font-medium">${customer.address || '-'}</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-600">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏á‡∏≤‡∏ô</p>
                            <p class="font-medium">${customer.workDetails || '-'}</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-600">‡∏ß‡∏±‡∏ô‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô</p>
                            <p class="font-medium">${customer.startDate || '-'}</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-600">‡∏ß‡∏±‡∏ô‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô</p>
                            <p class="font-medium">${customer.dueDate || '-'}</p>
                        </div>
                    </div>

                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4 bg-purple-50 p-4 rounded-lg">
                        <div>
                            <p class="text-sm text-gray-600">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ß‡∏°</p>
                            <p class="font-bold text-purple-800">${(parseFloat(customer.totalPrice) || 0).toLocaleString()} ‡∏ø</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-600">‡∏°‡∏±‡∏î‡∏à‡∏≥</p>
                            <p class="font-bold text-blue-800">${(parseFloat(customer.deposit) || 0).toLocaleString()} ‡∏ø</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-600">‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß</p>
                            <p class="font-bold text-green-800">${(parseFloat(customer.paid) || 0).toLocaleString()} ‡∏ø</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-600">‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</p>
                            <p class="font-bold text-red-800">${calculateRemaining(customer.totalPrice, customer.paid).toLocaleString()} ‡∏ø</p>
                        </div>
                    </div>

                    ${(customer.workImages.length > 0 || customer.chatImages.length > 0) ? `
                        <div class="space-y-3">
                            ${customer.workImages.length > 0 ? `
                                <div>
                                    <p class="text-sm font-medium text-gray-700 mb-2">‡∏£‡∏π‡∏õ‡∏á‡∏≤‡∏ô‡∏õ‡∏±‡∏Å (${customer.workImages.length})</p>
                                    <div class="flex gap-2 overflow-x-auto">
                                        ${customer.workImages.map(img => `
                                            <img src="${img}" alt="‡∏á‡∏≤‡∏ô‡∏õ‡∏±‡∏Å" class="h-24 w-24 object-cover rounded cursor-pointer hover:scale-105 transition" onclick="window.open('${img}')" />
                                        `).join('')}
                                    </div>
                                </div>
                            ` : ''}
                            ${customer.chatImages.length > 0 ? `
                                <div>
                                    <p class="text-sm font-medium text-gray-700 mb-2">‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡πÅ‡∏ä‡∏ó (${customer.chatImages.length})</p>
                                    <div class="flex gap-2 overflow-x-auto">
                                        ${customer.chatImages.map(img => `
                                            <img src="${img}" alt="‡πÅ‡∏ä‡∏ó" class="h-24 w-24 object-cover rounded cursor-pointer hover:scale-105 transition" onclick="window.open('${img}')" />
                                        `).join('')}
                                    </div>
                                </div>
                            ` : ''}
                        </div>
                    ` : ''}
                </div>
            `;
        }

        function renderSummary() {
            const totalRevenue = customers.reduce((sum, c) => sum + (parseFloat(c.totalPrice) || 0), 0);
            const totalPaid = customers.reduce((sum, c) => sum + (parseFloat(c.paid) || 0), 0);
            const totalRemaining = customers.reduce((sum, c) => sum + calculateRemaining(c.totalPrice, c.paid), 0);

            return `
                <div class="mt-6 bg-white rounded-lg shadow-lg p-6">
                    <h3 class="text-lg font-bold text-purple-800 mb-3">‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°</h3>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <div class="bg-purple-50 p-4 rounded-lg">
                            <p class="text-sm text-gray-600">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</p>
                            <p class="text-2xl font-bold text-purple-800">${customers.length}</p>
                        </div>
                        <div class="bg-blue-50 p-4 rounded-lg">
                            <p class="text-sm text-gray-600">‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏ß‡∏°</p>
                            <p class="text-2xl font-bold text-blue-800">${totalRevenue.toLocaleString()} ‡∏ø</p>
                        </div>
                        <div class="bg-green-50 p-4 rounded-lg">
                            <p class="text-sm text-gray-600">‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÅ‡∏•‡πâ‡∏ß</p>
                            <p class="text-2xl font-bold text-green-800">${totalPaid.toLocaleString()} ‡∏ø</p>
                        </div>
                        <div class="bg-red-50 p-4 rounded-lg">
                            <p class="text-sm text-gray-600">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö</p>
                            <p class="text-2xl font-bold text-red-800">${totalRemaining.toLocaleString()} ‡∏ø</p>
                        </div>
                    </div>
                </div>
            `;
        }

        // Initial render
        render();
    </script>
</body>
</html>
